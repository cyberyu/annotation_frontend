(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"4dad":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticStyle:{"background-color":"#f6f6f6"}},[s("div",{staticClass:"row self-start"},[s("q-breadcrumbs",{staticClass:"justify-start"},[s("q-breadcrumbs-el",{attrs:{label:"My Projects",icon:"home",to:"/"}}),s("q-breadcrumbs-el",{attrs:{label:"Project Summary",icon:"widgets",to:"/project/"+t.project.id}}),s("q-breadcrumbs-el",{attrs:{label:t.review?"Review":t.consensus?"Check Consensus":"Annotate",icon:"navigation"}})],1)],1),s("div",{staticClass:"row self-start q-pt-lg"},[s("div",{staticClass:"col-3"},[s("div",{staticClass:"justify-end  q-pr-md row"},[s("q-card",{staticClass:"col-8 "},[s("q-linear-progress",{attrs:{size:"25px",value:t.progressStats.pct,color:"accent"}},[s("div",{staticClass:"absolute-full flex flex-center"},[s("q-badge",{attrs:{color:"white","text-color":"accent",label:t.progressStats.label}})],1)]),s("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("q-tab",{attrs:{name:"models",label:t.consensus?"Consensus Models":"Models"}}),t.consensus?t._e():s("q-tab",{attrs:{name:"rules",label:"Rules"}}),t.consensus?t._e():s("q-tab",{attrs:{name:"dicts",label:"Dictionaries"}})],1),s("q-separator"),s("q-tab-panels",{attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[t.consensus?s("q-tab-panel",{attrs:{name:"models"}},t._l(t.project.cmodels,(function(e,n){return s("div",{key:n},[s("q-btn",{staticClass:"bg-primary",attrs:{loading:t.modelQueue.indexOf(t.tab+e.id)>=0,disable:t.processedQ.indexOf(t.tab+e.id)>=0,label:e.name,"text-color":"white"},on:{click:function(s){return t.executeModel(e.id)}},scopedSlots:t._u([{key:"loading",fn:function(){return[s("q-spinner-hourglass",{staticClass:"on-left"}),t._v("\n                      Loading...\n                    ")]},proxy:!0}],null,!0)}),t.cmodels[e.id]&&t.cmodels[e.id].consensusScore.total?s("q-circular-progress",{staticClass:"q-ma-xs",attrs:{"show-value":"","font-size":"12px",value:t.cmodels[e.id].consensusScore.total,size:"35px",thickness:.22,color:"red","track-color":"grey-3"}},[t._v("\n                    "+t._s(t.cmodels[e.id].consensusScore.total.toFixed(1))+"\n                  ")]):t._e(),t.cmodels[e.id]&&t.cmodels[e.id].consensusScore.f1?s("q-circular-progress",{staticClass:"q-ma-xs",attrs:{"show-value":"","font-size":"12px",value:t.cmodels[e.id].consensusScore.f1,size:"35px",thickness:.22,color:"teal","track-color":"grey-3"}},[t._v("\n                    "+t._s(t.cmodels[e.id].consensusScore.f1.toFixed(1))+"\n                  ")]):t._e(),s("q-tooltip",{attrs:{"content-class":"bg-indigo",delay:1e3,offset:[10,10],"max-width":"250px"}},[t._v(" "+t._s(e.note)+" ")])],1)})),0):s("q-tab-panel",{attrs:{name:"models"}},[t._l(t.project.vmodels,(function(e,n){return s("div",{key:n,staticClass:"q-pa-sm"},[s("q-btn",{staticClass:"bg-primary",attrs:{loading:t.modelQueue.indexOf(t.tab+e.id)>=0,disable:t.processedQ.indexOf(t.tab+e.id)>=0,label:e.name,"text-color":"white"},on:{click:function(s){return t.executeModel(e.id)}},scopedSlots:t._u([{key:"loading",fn:function(){return[s("q-spinner-hourglass",{staticClass:"on-left"}),t._v("\n                      Loading...\n                    ")]},proxy:!0}],null,!0)}),s("q-tooltip",{attrs:{"content-class":"bg-indigo",delay:1e3,offset:[10,10],"max-width":"250px"}},[t._v(" "+t._s(e.note)+" ")])],1)})),0===t.project.vmodels.length?s("div",[t._v("\n                  No model defined for this project yet\n                ")]):t._e()],2),s("q-tab-panel",{attrs:{name:"rules"}},[t._l(t.project.rules,(function(e,n){return s("div",{key:n,staticClass:"q-pa-sm"},[s("q-btn",{staticClass:"bg-primary",attrs:{loading:t.modelQueue.indexOf(t.tab+e.id)>=0,disable:t.processedQ.indexOf(t.tab+e.id)>=0,label:e.name,"text-color":"white"},on:{click:function(s){return t.executeModel(e.id)}},scopedSlots:t._u([{key:"loading",fn:function(){return[s("q-spinner-hourglass",{staticClass:"on-left"}),t._v("\n                      Loading...\n                    ")]},proxy:!0}],null,!0)}),s("q-tooltip",{attrs:{"content-class":"bg-indigo",delay:1e3,offset:[10,10],"max-width":"250px"}},[t._v(" "+t._s(e.note)+" ")])],1)})),0===t.project.rules.length?s("div",[t._v("\n                  No rule defined for this project yet\n                ")]):t._e()],2),s("q-tab-panel",{attrs:{name:"dicts"}},[t._l(t.project.dicts,(function(e,n){return s("div",{key:n,staticClass:"q-pa-sm"},[s("q-btn",{staticClass:"bg-primary",attrs:{loading:t.modelQueue.indexOf(t.tab+e.id)>=0,disable:t.processedQ.indexOf(t.tab+e.id)>=0,label:e.name,"text-color":"white"},on:{click:function(s){return t.executeModel(e.id)}},scopedSlots:t._u([{key:"loading",fn:function(){return[s("q-spinner-hourglass",{staticClass:"on-left"}),t._v("\n                      Loading...\n                    ")]},proxy:!0}],null,!0)}),s("q-tooltip",{attrs:{"content-class":"bg-indigo",delay:1e3,offset:[10,10],"max-width":"250px"}},[t._v(" "+t._s(e.note)+" ")])],1)})),0===t.project.dicts.length?s("div",[t._v("\n                  No dictionary defined for this project yet\n                ")]):t._e()],2)],1)],1)],1)]),s("div",{staticClass:"col-6 bg-white"},[s("q-card-actions",{staticClass:"bg-white annotation-header"},t._l(t.labels,(function(e,n){return s("q-btn",{key:n,staticClass:"q-mr-xs",staticStyle:{"margin-left":"0px"},style:"color: "+e.color,attrs:{outline:"",size:"sm"}},[t._v(" "+t._s(e.name))])})),1),s("q-separator"),s("q-scroll-area",{ref:"textArea",staticClass:"col",staticStyle:{height:"calc(100vh - 200px)",display:"flex"}},[t.tokens&&t.tokens.length>0?s("div",{staticClass:"select-box q-pa-sm",attrs:{tabindex:"0"},on:{keyup:t.key,focusout:function(e){t.selected=[]}}},t._l(t.tokens,(function(e,n){return s("div",{key:n,class:"\r\n"===e[0]?"row q-my-sm":"column inline",attrs:{id:"t-"+n}},[s("span",{staticClass:"q-pt-xs token",staticStyle:{position:"relative"},attrs:{id:t.selected[0]===n?"selected":null},on:{mousedown:function(e){t.selectStart(n),t.mousePressed=!0},mouseup:function(e){t.selectEnd(n),t.mousePressed=!1},mouseover:function(e){t.mousePressed&&t.select(n)}}},[t.isPunct(n)?t._e():s("span",{class:t.getTokenClass(n),staticStyle:{"white-space":"pre"}},[t._v("Â ")]),s("span",{class:t.getTokenClass(n)},[t._v(t._s(e[0]))]),t._l(t.detailedAnnotations[n],(function(e,o){return s("div",{key:o,class:""+t.getPosOfLabel(n,o,e).order,style:t.getPosOfLabel(n,o,e).cls})}))],2),t.selected[0]===n?s("q-card",{staticClass:"label-window fixed q-px-md q-py-sm",style:"top: "+t.offsetTop+"px;",attrs:{id:"label-window"}},t._l(t.labels,(function(e,o){return s("div",{key:o,staticClass:"col-12",style:"color:"+e.color},[t.detailedAnnotations[n]&&t.detailedAnnotations[n].map((function(t){return t[1].id})).includes(e.id)?s("div",{on:{click:function(s){t.removeAnnotation(n,t.findAnnotation(n,e.id))}}},[s("q-icon",{attrs:{name:"check_circle"}}),t._v("\n                    "+t._s(e.name)+"\n                  ")],1):s("div",{on:{click:function(s){return t.annotate(e)}}},[s("q-icon",{attrs:{name:"radio_button_unchecked"}}),t._v("\n                    "+t._s(e.name)+"\n                  ")],1)])})),0):t._e(),t.detailedAnnotations[n]?s("span",{staticClass:"label",class:{"active-label shadow-4":t.activeLabel==="l-"+n},staticStyle:{position:"absolute"},style:"margin-top: "+(2.2+.25*t.detailedAnnotations[n].length+t.prevTight(n))+"em",attrs:{id:"l-"+n},on:{mouseover:function(e){t.activeLabel="l-"+n},mouseleave:function(e){t.activeLabel=null}}},[t._l(t.detailedAnnotations[n],(function(e,o){return s("span",{key:"label"+o,staticClass:"label",style:"color:"+t.getColor(e[1])},["B"===e[0]?s("span",{style:"margin-left:"+(2*o-4)+"px"},[e[1].m?s("q-avatar",{style:"background-color:"+t.getColor(e[1]),attrs:{"text-color":"white",size:"12px"},on:{click:function(s){return t.removeAnnotation(n,e[1])}}},[t._v("\n                      m\n                    ")]):s("q-icon",{attrs:{name:"check_circle"},on:{click:function(s){return t.removeAnnotation(n,e[1])}}}),t._v(" "+t._s(e[1].name)+" "),s("br")],1):t._e()])})),t.review?s("q-menu",{attrs:{anchor:"top right",self:"top left"}},[s("q-list",{attrs:{bordered:"",separator:""}},t._l(t.detailedAnnotations[n],(function(e,n){return s("q-item",{key:"label"+n,attrs:{clickable:"",dense:""}},[e[1].authors?s("q-item-section",[s("span",{staticClass:"text-bold"},[t._v(t._s(e[1].name)+" ("+t._s(e[1].authors.length)+") - "+t._s(e[1].text))]),s("div",{staticClass:"q-px-sm"},t._l(e[1].authors,(function(e,n){return s("div",{key:"author"+n},[t._v("\n                          "+t._s(e)+"\n                        ")])})),0)]):t._e()],1)})),1)],1):t._e()],2):t._e(),t.detailedAnnotations[n]?s("span",{style:"height: "+(18*t.detailedAnnotations[n].filter((function(t){return"B"==t[0]})).length+4*t.detailedAnnotations[n].length)+"px"}):t._e()],1)})),0):t._e()]),s("q-separator"),s("q-card-actions",{staticClass:"justify-center"},[s("q-btn",{staticClass:"justify-center",staticStyle:{width:"100px"},attrs:{color:"primary",label:"Previous",disable:!t.prevURL},on:{click:function(e){return t.fetchDocs(t.prevURL)}}}),s("q-btn",{staticClass:"justify-center q-ml-md",staticStyle:{width:"100px"},attrs:{color:"accent",label:"Save",loading:t.saving},on:{click:function(e){return t.saveAnnotations()}},scopedSlots:t._u([{key:"loading",fn:function(){return[t._v("\n                     Saving...\n                   ")]},proxy:!0}])}),s("q-btn",{staticClass:"justify-center q-ml-md",staticStyle:{width:"100px"},attrs:{color:"primary",label:"Next"},on:{click:function(e){t.nextURL?t.fetchDocs(t.nextURL):t.$router.push("/")}}})],1)],1),s("div",{staticClass:"col-2 summary q-mb-none"},[s("q-card",[s("q-card-actions",{staticClass:"bg-accent annotation-header justify-between",style:"color: white; font-weight: bold; font-size: 1.2em"},[s("q-btn",{class:{"bg-purple-5":"annotations"==t.showTab},attrs:{label:"ANNOTATIONS",flat:""},on:{click:function(e){t.showTab="annotations"}}},[s("q-badge",{attrs:{color:"info",floating:""}},[t._v(" "+t._s(t.annotations.length))])],1),s("q-btn",{staticClass:"float-right",class:{"bg-purple-5":"sort"==t.showTab},attrs:{icon:"sort",flat:""},on:{click:function(e){t.showTab="sort"}}},[t.modelResultCache?s("q-badge",{attrs:{color:"info",floating:""}},[t._v(" "+t._s(t.modelResultCache.length))]):t._e()],1),t.review?s("q-btn",{staticClass:"float-right",class:{"bg-purple-5":"annotators"==t.showTab},attrs:{icon:"group",flat:""},on:{click:function(e){t.showTab="annotators"}}},[t.annotations4Review?s("q-badge",{attrs:{color:"info",floating:""}},[t._v(" "+t._s(Object.keys(t.annotations4Review).length))]):t._e()],1):t._e(),s("q-btn",{staticClass:"float-right",class:{"bg-purple-5":"conflicts"==t.showTab},attrs:{icon:"visibility",flat:""},on:{click:function(e){t.showTab="conflicts"}}},[s("q-badge",{attrs:{color:"red",floating:""}},[t._v(t._s(Object.keys(t.conflicts).length))])],1)],1),s("q-scroll-area",{staticClass:"col",staticStyle:{height:"calc(100vh - 180px)",display:"flex"}},[t.tokens&&"annotations"===t.showTab?s("q-list",{staticClass:"bg-white",attrs:{bordered:""}},t._l(Object.entries(t.categorizedAnnotations),(function(e,n){return s("q-expansion-item",{key:n,attrs:{"expand-separator":"","header-style":"color: "+(t.lLabels[e[0]]|t.lLabels[null]).color,"header-class":"header-label",label:e[0]+" ("+e[1].length+")"}},[s("div",{staticClass:"summary-word q-pb-sm"},t._l(e[1].sort((function(t,e){return t.pos[0]-e.pos[0]})),(function(e,n){return s("li",{key:n,staticStyle:{"list-style":"circle"}},[s("span",[e.m?s("q-avatar",{attrs:{color:"red",size:"12px","text-color":"white"},on:{click:function(s){return t.removeAnnotation(e.tpos[0],e)}}},[t._v(" m ")]):t._e(),s("span",{on:{click:function(s){return t.scrollTo(e)}}},[t._v(t._s(e.pos)+" - "+t._s(e.text))])],1)])})),0)])})),1):t._e(),t.tokens&&t.modelResultCache&&"sort"===t.showTab?s("q-list",{staticClass:"q-pa-sm"},[t._l(t.modelResultCache,(function(e,n){return s("div",{key:n},[s("q-avatar",{attrs:{color:"red",size:"12px","text-color":"white"},on:{click:function(s){t.removeAnnotation(e.tpos[0],e),t.removeFromModelCache(e.tpos[0],e)}}},[t._v(" m ")]),s("span",{on:{click:function(s){return t.scrollTo(e)}}},[e.confidence?s("span",[t._v("("+t._s(e.confidence.toFixed(2))+")")]):t._e(),t._v(" "+t._s(e.pos)+" - "+t._s(e.text)+"\n                ")])],1)})),s("div",{staticClass:"flex justify-center"},[s("q-btn",{staticClass:"q-mt-sm",attrs:{label:"Clear model results",color:"primary"},on:{click:function(e){t.modelResultCache=null}}})],1)],2):t._e(),t.tokens&&"conflicts"===t.showTab?s("q-list",{staticClass:"bg-white",attrs:{bordered:"",separator:""}},[0===Object.keys(t.conflicts).length?s("span",{staticClass:"text-subtitle2 q-pa-sm"},[t._v(" Cool, there is no conflict")]):t._e(),t._l(Object.entries(t.conflicts),(function(e,n){return s("q-item",{key:n,attrs:{label:e[0]+" ("+e[1].length+")"}},[s("div",{},t._l(e[1],(function(e,n){return s("div",{key:n,staticStyle:{"list-style":"circle"}},[s("span",[e.m?s("q-avatar",{attrs:{color:"red",size:"12px","text-color":"white"},on:{click:function(s){return t.removeAnnotation(e.tpos[0],e)}}},[t._v(" m ")]):s("q-avatar",{attrs:{size:"12px"}}),s("span",{on:{click:function(s){return t.scrollTo(e)}}},[t._v(t._s(e.pos)+" - "+t._s(e.text)+" ã"+t._s(e.name)+"ã")])],1)])})),0)])}))],2):t._e(),t.tokens&&"annotators"===t.showTab?s("q-list",{staticClass:"bg-white",attrs:{bordered:"",separator:""}},t._l(t.annotations4Review,(function(e,n,o){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:o,staticClass:"q-pr-xs",attrs:{clickable:"",active:t.activeAuthors.includes(n),"active-class":"bg-teal-1 text-grey-8"}},[s("q-item-section",[s("div",{staticClass:"col-9",on:{click:function(e){return t.getAnnotations(n)}}},[t._v(t._s(e.author)+" ("+t._s(e.annotations.length)+")")])]),s("q-item-section",{attrs:{side:""}},[s("q-btn-dropdown",{attrs:{color:"primary",flat:"",size:"sm",dense:"",label:"","dropdown-icon":{1:"check_circle","-1":"highlight_off",2:"redo"}[e.status]}},[s("q-list",{attrs:{bordered:""}},[s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],class:{"text-positive":1===e.status},attrs:{dense:"",clickable:""},on:{click:function(s){return t.rejectOrAccept(e,1)}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:1===e.status?"check_circle":"check",flat:"",size:"sm"}})],1),s("q-item-section",[t._v("\n                          Accept\n                        ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],class:{"text-negative":-1===e.status},attrs:{clickable:""},on:{click:function(s){return t.rejectOrAccept(e,-1)}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:-1===e.status?"highlight_off":"clear",flat:"",size:"sm"}})],1),s("q-item-section",[t._v("\n                          Reject\n                        ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],class:{"text-negative":2===e.status},attrs:{clickable:""},on:{click:function(s){return t.rejectOrAccept(e,2)}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"redo",flat:"",size:"sm"}})],1),s("q-item-section",[t._v("\n                          Ask for redo\n                        ")])],1)],1)],1)],1)],1)})),1):t._e()],1)],1)],1)])])},o=[],a=(s("4e82"),s("ddb0"),{name:"Annotate",props:["project","review","consensus"],data(){return{documents:[],document:null,tokens:null,start:null,end:null,labels:{},doneFetchLabels:!1,annotations:[],detailedAnnotations:[],selected:[],highlighted:[],mousePressed:!1,nextURL:null,prevURL:null,tab:"models",loading:!1,saving:!1,currentModel:null,modelQueue:[],processedQ:[],offsetTop:null,isAnnotated:null,numAnnotated:0,annotations4Review:null,showTab:"annotations",activeAuthors:[],feedback:"",modelResultCache:null,activeLabel:null,annotationOrders:null,cmodels:{},consensusScore:null}},mounted(){this.project.labels.forEach((t=>{this.labels[t.id]=t})),this.project.cmodels.forEach((t=>{this.cmodels[t.id]=t,this.cmodels[t.id].consensusScore={f1:null,total:null}}));const t={id:null,description:"a dummy label for labels which were createad in the project",color:"#e0e0e0",name:"NULL"};this.labels.null=t;const e={id:"misc",description:"misc",color:"#e0e0e0",name:"MISC"};this.labels.misc=e,this.fetchDocs(),setTimeout((()=>{this.$forceUpdate()}))},methods:{rejectOrAccept(t,e){t.status=t.status===e?0:e;const s=`/api/annotations/${t.id}/`,n={status:t.status};this.$axios.patch(s,n).then((t=>{console.log(t.data)})),this.annotations=this.mergeAnnotations(this.activeAuthors),this.getDetailedAnnotations(),this.$forceUpdate()},getAnnotations(t){const e=this.activeAuthors.indexOf(t);e>=0?this.activeAuthors.splice(e,1):this.activeAuthors.push(t),this.annotations=this.mergeAnnotations(this.activeAuthors),this.getDetailedAnnotations()},mergeAnnotations(t){t&&0!==t.length||(t=Object.keys(this.annotations4Review));const e=t.length;let s=[];for(let n=0;n<e;n++){const e=this.annotations4Review[t[n]];-1!==e.status&&(s=s.concat(e.annotations.map((t=>(t.author=e.author,t)))))}return s.forEach((t=>t.authors=[])),s=s.filter(((t,e,n)=>e===n.findIndex((n=>String(n.pos)===String(t.pos)&&n.name===t.name&&(n.authors.push(s[e].author),!0))))),s},getColor(t){return this.labels[t.id].color},getPosOfLabel(t,e,s){const n=this.annotationOrders[t][this.getKey(s)],o=1+4*n,a=`\n      margin-top: ${o}px;\n      position: absolute;\n      width:calc(100% - ${"B"===s[0]?4+2*n:0}px);\n      border-bottom: solid ${this.getColor(s[1])} 2px;\n      margin-left: ${"B"===s[0]?4+2*n:0}px\n      `;return{order:n,pos:o,name:s.name,cls:a}},prevTight(t){let e=0;return 0===t||!this.detailedAnnotations[t-1]||this.detailedAnnotations[t-1].length<1?e:(this.detailedAnnotations[t-1].forEach((t=>{const s=this.tokens[t[1].tpos[0]][0];"B"===t[0]&&s.length<t[1].name.length&&(e+=1)})),0===e?0:e-Math.floor(this.detailedAnnotations[t].length/4))},add2Q(t){const e=this.tab+t;this.modelQueue.push(e)},removeFromQ(t){const e=this.tab+t,s=this.modelQueue.indexOf(e);this.modelQueue.splice(s,1),this.processedQ.push(e)},existInAnnotations(t){return this.annotations.some((e=>e.pos[0]===t.pos[0]&&e.pos[1]===t.pos[1]&&e.name===t.name))},findAnnotation(t,e){let s;return this.detailedAnnotations[t].forEach((t=>{t[1].id===e&&(s=t[1])})),s},executeModel(t){this.add2Q(t);const e={mtype:this.tab,id:t,document:this.document.id},s=this.consensus?"/api/calculate_consensus/":"/api/calculate/";this.$axios.post(this.$hostname+s,e).then((e=>{const s=e.data.result;this.alignTokens(s),s.forEach((t=>{t.m="m",t.id=this.lLabels[t.name]?this.lLabels[t.name].id:null;const e=t;this.existInAnnotations(e)||this.annotations.push(e)})),this.getDetailedAnnotations(),this.removeFromQ(t),this.modelResultCache?this.modelResultCache=this.modelResultCache.concat(s):this.modelResultCache=s,this.modelResultCache.sort(((t,e)=>e.confidence-t.confidence));const n=`Finished running model, and got ${s.length} results`;this.$q.notify({message:n,color:"secondary",position:"center",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{}},{label:"Review",color:"white",handler:()=>{this.showTab="sort"}}]}),this.consensus&&(this.cmodels[t].consensusScore={f1:100*e.data.f1,total:100*e.data.total})}))},scrollTo(t){let e=t.tpos;e[0]>e[1]&&(e=[e[0],e[0]]);const s=`t-${e[0]}`;this.highlighted=Array(e[1]-e[0]+1).fill(e[0]).map(((t,e)=>t+e)),document.getElementById(s).scrollIntoView({block:"center"})},selectStart(t){this.start=t,this.selected=[t]},selectEnd(t){this.end=t,this.end<this.start&&(this.end=this.start,this.start=t)},select(t){const e=Math.min(t,this.start),s=Math.max(t,this.start);this.selected=[...Array(s-e+1).keys()].map((t=>t+e))},getTokenClass(t){let e;return e=this.detailedAnnotations[t]?this.detailedAnnotations[t][0][0]:"",e+=this.selected.includes(t)?" selected":"",e+=this.highlighted.includes(t)?" highlight":"",e},isPunct(t){const e=".,!\"'",s=this.tokens[t][0][0];return e.includes(s)},getWidth(t,e){let s=0;const n=this.detailedAnnotations[t][e][1].tpos;for(let o=n[0];o<n[1]+1;o++){const t=document.getElementById("t-"+o);t&&(s+=t.offsetWidth)}return s},annotate(t){const e=this.tokens[this.start][2],s=this.tokens[this.end][2]+(this.tokens[this.end][0].length-1),n={id:t.id,name:t.name,pos:[e,s],tpos:[this.start,this.end],text:this.document.text.substring(e,s+1)};for(let o=0;o<this.annotations.length;o++){const e=this.annotations[o];if(e.pos[0]===n.pos[0]&&e.pos[1]===n.pos[1]){if(e.id===t.id)return alert("already there"),0;this.annotations.splice(o,1)}}this.annotations.push(n),this.getDetailedAnnotations()},removeFromModelCache(t,e){const s=this.modelResultCache.indexOf(e);this.modelResultCache.splice(s,1)},removeAnnotation(t,e){const s=this.annotations.indexOf(e);this.annotations.splice(s,1),this.getDetailedAnnotations()},key(t){console.log("key pressed: ",t.key)},compressAnnotations(){},saveAnnotations(){if(Object.keys(this.conflicts).length>0){const t="You must resolve all conflicts before saving.";return this.$q.notify({message:t,color:"secondary",position:"center",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]}),-1}this.saving=!0;const t={document:this.document.id,annotations:this.annotations};let e,s;this.document.annotations.id?(s="patch",e=this.$hostname+"/api/annotations/"+this.document.annotations.id+"/"):(s="post",e=this.$hostname+"/api/annotations/"),0===this.annotations.length&&console.log(0),this.$axios({method:s,url:e,data:t}).then((e=>{this.saving=!1,!this.isAnnotated&&t.annotations.length>=1?this.incrProgress(1):this.isAnnotated&&0===t.annotations.length&&this.incrProgress(-1)}))},incrProgress(t){this.numAnnotated+=t},fetchDocs(t){if(t){const e=t.split("/").length;t="/"+t.split("/").splice(e-3,e).join("/")}else t=`/api/documents/?project=${this.project.id}&review=${this.review}&consensus=${this.consensus}`;this.$axios.get(t).then((t=>{this.documents=t.data.results,this.nextURL=t.data.next,this.prevURL=t.data.previous,this.document=this.documents[0],this.annotations=this.document.annotations.id?this.document.annotations.annotations:[],this.review&&(this.annotations4Review=this.document.reviews,this.annotations=this.mergeAnnotations()),this.consensus&&(this.document.gold.annotations.forEach((t=>{t.id=this.lLabels[t.name]?this.lLabels[t.name].id:null})),this.annotations=this.document.gold.annotations),this.isAnnotated=this.document.annotations.id,this.tokens=this.document.tokens,this.getDetailedAnnotations(),this.highlighted=[],this.processedQ=[],this.modelQueue=[],this.consensus&&this.project.cmodels.forEach((t=>{this.cmodels[t.id].consensusScore.f1=null}))})),this.modelResultCache=null,this.$refs.textArea.setScrollPosition("vertical",0)},alignTokens(t){t.forEach((t=>{t.name||(t.name=this.labels[t.id].name);const e=t.tpos[0],s=t.tpos[1],n=t.pos[0],o=t.pos[1];for(let a=0;a<this.tokens.length;a++)this.tokens[a][2]===n?(t.tpos[0]=a,e===s&&(t.tpos[1]=a)):this.tokens[a][2]>n&&this.tokens[a][2]<o&&(t.tpos[1]=a)}))},getDetailedAnnotations(){this.detailedAnnotations=new Array(this.tokens.length).fill(null),this.annotations.forEach((t=>{t.name||(t.name=this.labels[t.id].name);const e=t.tpos[0],s=t.tpos[1],n=t.pos[0],o=t.pos[1];let a;for(let i=0;i<this.tokens.length;i++)this.tokens[i][2]===n?(t.tpos[0]=i,e===s&&(t.tpos[1]=i),a=["B",t],this.detailedAnnotations[i]||(this.detailedAnnotations[i]=[]),this.detailedAnnotations[i].push(a)):this.tokens[i][2]>n&&this.tokens[i][2]<o&&(t.tpos[1]=i,a=["I",t],this.detailedAnnotations[i]||(this.detailedAnnotations[i]=[]),this.detailedAnnotations[i].push(a))})),this.getLabelOrder()},getKey(t){return`${t[1].name}-${t[1].pos[0]}-${t[1].pos[1]}`},getLabelOrder(){const t=[];this.detailedAnnotations.forEach(((e,s)=>{if(e){const n={},o=[];let a=Array(e.length).fill().map(((t,e)=>e));e.forEach(((e,a)=>{const i=this.getKey(e);if(0===s)n[i]=a;else if("I"===e[0]){const s=t[e[1].tpos[0]][this.getKey(e)];n[i]=s,o.push(s)}})),a=a.filter((t=>!o.includes(t))),s>0&&e.forEach(((t,e)=>{const s=this.getKey(t);"B"===t[0]&&(n[s]=a.shift())})),t.push(n)}else t.push(null)})),this.annotationOrders=t},getSelection(t){this.highlight(this.documents[0].text,t.start,t.end)},highlight(t,e,s){this.text=`${t.substring(0,e)}<span style="background-color: red">${t.substring(e,s)}</span>${t.substring(s)}`},getTokenOffsetTop(t){const e="t-"+t;return document.getElementById(e).getBoundingClientRect().top}},computed:{progressStats(){const t=this.project.num_of_annotated_docs+this.numAnnotated,e=t/this.project.num_of_docs,s=(100*e).toFixed(2)+"%"+` (${t}/${this.project.num_of_docs})`;return{pct:e,label:s}},categorizedAnnotations(){const t={};return this.annotations.forEach((e=>{[e].forEach((e=>{const s=e.name||this.labels[e.id].name;t[s]?t[s].push(e):t[s]=[e]}))})),t},conflicts(){const t={};this.annotations.forEach((e=>{const s=JSON.stringify(e.pos);t[s]?t[s].push(e):t[s]=[e]}));const e={};return Object.keys(t).forEach((s=>{t[s].length>1&&(e[s]=t[s])})),e},lLabels(){const t={};return Object.entries(this.labels).forEach((e=>{t[e[1].name]=e[1]})),t}},watch:{selected(t){this.highlighted=[],this.$nextTick((()=>{if(t.length>0){const t=document.getElementById("selected").getBoundingClientRect(),e=t.top,s=document.getElementById("label-window").getBoundingClientRect().height;e>s+t.height?this.offsetTop=e-s-t.height:this.offsetTop=e}}))}}}),i=a,l=(s("8248"),s("2877")),c=s("9989"),r=s("ead5"),d=s("079e"),h=s("f09f"),u=s("6b1d"),p=s("58a81"),m=s("429b"),f=s("7460"),g=s("eb85"),b=s("adad"),v=s("823b"),_=s("9c40"),y=s("9149"),x=s("05c0"),k=s("58ea"),q=s("4b7e"),w=s("4983"),A=s("0016"),C=s("cb32"),j=s("4e73"),S=s("1c1c"),Q=s("66e5"),T=s("4074"),O=s("3b73"),R=s("f20b"),L=s("714f"),$=s("eebe"),E=s.n($),P=Object(l["a"])(i,n,o,!1,null,null,null);e["default"]=P.exports;E()(P,"components",{QPage:c["a"],QBreadcrumbs:r["a"],QBreadcrumbsEl:d["a"],QCard:h["a"],QLinearProgress:u["a"],QBadge:p["a"],QTabs:m["a"],QTab:f["a"],QSeparator:g["a"],QTabPanels:b["a"],QTabPanel:v["a"],QBtn:_["a"],QSpinnerHourglass:y["a"],QTooltip:x["a"],QCircularProgress:k["a"],QCardActions:q["a"],QScrollArea:w["a"],QIcon:A["a"],QAvatar:C["a"],QMenu:j["a"],QList:S["a"],QItem:Q["a"],QItemSection:T["a"],QExpansionItem:O["a"],QBtnDropdown:R["a"]}),E()(P,"directives",{Ripple:L["a"]})},8248:function(t,e,s){"use strict";s("82c1")},"82c1":function(t,e,s){}}]);