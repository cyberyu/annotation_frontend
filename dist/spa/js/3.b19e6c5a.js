(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"4dad":function(t,s,n){"use strict";n.r(s);var e=function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("q-page",{staticClass:"flex"},[n("div",{staticClass:"row self-start"},[n("q-breadcrumbs",{staticClass:"justify-start"},[n("q-breadcrumbs-el",{attrs:{label:"My Projects",icon:"home",to:"/"}}),n("q-breadcrumbs-el",{attrs:{label:"Project Summary",icon:"widgets",to:"/project/"+t.project.id}}),n("q-breadcrumbs-el",{attrs:{label:"Annotate",icon:"navigation"}})],1)],1),n("div",{staticClass:"row self-start"},[n("div",{staticClass:"col-2"}),n("div",{staticClass:"col-8"},[t.tokens&&t.doneFetchLabels?n("div",{staticClass:"select-box",attrs:{tabindex:"0"},on:{keyup:t.key,focusout:function(s){t.selected=[]}}},t._l(t.tokens,(function(s,e){return n("div",{key:e,staticClass:"column inline",attrs:{id:"t-"+e}},[n("span",{staticClass:"q-px-xs q-pt-xs token",class:t.getTokenClass(e),on:{mousedown:function(s){t.selectStart(e),t.mousePressed=!0},mouseup:function(s){t.selectEnd(e),t.mousePressed=!1},mouseover:function(s){t.mousePressed&&t.select(e)}}},[t._v("\n            "+t._s(s)+"\n          ")]),t.selected[0]===e?n("q-card",{staticClass:"label-window q-px-md q-py-sm",attrs:{bordered:""}},t._l(t.labels,(function(s,o){return n("div",{key:o,staticClass:"col-12",style:"color:"+s.color},[t.detailedAnnotations[e]&&t.detailedAnnotations[e][1].includes(s.id)?n("div",{on:{click:function(n){return t.removeAnnotation(e,s.id)}}},[n("q-icon",{attrs:{name:"check_circle"}}),t._v("\n                "+t._s(s.name)+"\n              ")],1):n("div",{on:{click:function(n){return t.annotate(s)}}},[n("q-icon",{attrs:{name:"radio_button_unchecked"}}),t._v("\n                "+t._s(s.name)+"\n              ")],1)])})),0):t._e(),t.selected[0]===e&&0==t.mousePressed||!t.detailedAnnotations[e]||"B"!==t.detailedAnnotations[e][0]?t._e():n("span",t._l(t.detailedAnnotations[e][1],(function(s,o){return n("span",{key:"label"+o,staticClass:"label",style:"color:"+t.labels[s].color},[n("q-icon",{attrs:{name:"check_circle"},on:{click:function(n){return t.removeAnnotation(e,s)}}}),t._v(" "+t._s(t.labels[s].name)+" "),n("br")],1)})),0)],1)})),0):t._e(),n("div",{staticClass:"row justify-center col-12 q-mt-md"},[n("q-btn",{staticClass:"justify-center",attrs:{color:"primary",label:"Previous",disable:!t.prevURL},on:{click:function(s){return t.fetchDocs(t.prevURL)}}}),n("q-btn",{staticClass:"justify-center q-ml-md",attrs:{color:"primary",label:"Submit and Next"},on:{click:function(s){t.saveAnnotations(),t.nextURL?t.fetchDocs(t.nextURL):t.$router.push("/")}}})],1)]),n("div",{staticClass:"col-2 summary"},[t.tokens?n("q-scroll-area",{staticStyle:{height:"100%"}},t._l(Object.entries(t.categorizedAnnotations),(function(s,e){return n("div",{key:e,staticClass:"summary-block"},[n("div",{staticClass:"summary-label"},[n("span",{style:"color: "+t.lLabels[s[0]].color},[t._v(t._s(s[0]))]),t._v(" ("+t._s(s[1].length)+")")]),n("ul",{staticClass:"summary-word"},t._l(s[1],(function(s,e){return n("li",{key:e},[t._v("\n              "+t._s(s.index)+" - "+t._s(s.word)+"\n            ")])})),0)])})),0):t._e()],1)])])},o=[],a=(n("ddb0"),{name:"Annotate",props:["project"],data(){return{documents:[],document:null,tokens:null,start:null,end:null,labels:{},doneFetchLabels:!1,annotations:[],detailedAnnotations:[],selected:[],mousePressed:!1,nextURL:null,prevURL:null}},mounted(){this.fetchLabels(),this.fetchDocs()},methods:{fetchLabels(){const t=this.$hostname+"/labels/";this.$axios.get(t).then((t=>{t.data.forEach((t=>{this.labels[t.id]=t})),this.doneFetchLabels=!0}))},selectStart(t){this.start=t,this.selected=[t]},selectEnd(t){this.end=t,this.end<this.start&&(this.end=this.start,this.start=t)},select(t){const s=Math.min(t,this.start),n=Math.max(t,this.start);this.selected=[...Array(n-s+1).keys()].map((t=>t+s))},getTokenClass(t){let s;return s=this.detailedAnnotations[t]?this.detailedAnnotations[t][0]:"",s+=this.selected.includes(t)?" selected":"",s},annotate(t){for(let n=0;n<this.annotations.length;n++)if(this.annotations[n][0]===this.start)return this.annotations[n][2].includes(t.id)?alert("already there"):this.annotations[n][2].push(t.id),0;const s=[this.start,this.end,[t.id]];this.annotations.push(s),this.getDetailedAnnotations()},removeAnnotation(t,s){for(let n=0;n<this.annotations.length;n++)if(this.annotations[n][0]===t){const t=this.annotations[n][2].indexOf(s);console.log("find label",t),this.annotations[n][2].splice(t,1),0===this.annotations[n][2].length&&this.annotations.splice(n,1)}this.getDetailedAnnotations()},key(t){console.log("key pressed: ",t.key)},getDetailedAnnotations(){this.detailedAnnotations=new Array(this.tokens.length),this.annotations.map((t=>{const s=t[0],n=t[1],e=t[2];for(let o=s;o<=n;o++)this.detailedAnnotations[o]=o===s?["B",e]:["I",e];return 0}))},compressAnnotations(){},saveAnnotations(){const t={document:this.document.id,annotations:this.annotations};let s,n;this.document.annotations.id?(n="patch",s=this.$hostname+"/annotations/"+this.document.annotations.id+"/"):(n="post",s=this.$hostname+"/annotations/"),0===this.annotations.length&&console.log(0),this.$axios({method:n,url:s,data:t}).then((t=>{}))},fetchDocs(t){if(t){const s=t.split("/").length;t=this.$hostname+"/"+t.split("/").splice(s-2,s).join("/"),console.log("hostname",this.$hostname),console.log("next url",t)}else t=this.$hostname+"/documents/";this.$axios.get(t).then((t=>{console.log("use host",this.$hostname),this.documents=t.data.results,this.nextURL=t.data.next,this.prevURL=t.data.previous,this.document=this.documents[0],this.annotations=this.document.annotations.id?this.document.annotations.annotations:[],this.tokens=this.document.text.split(" "),this.getDetailedAnnotations()}))},getSelection(t){console.log(t),this.highlight(this.documents[0].text,t.start,t.end)},highlight(t,s,n){this.text=`${t.substring(0,s)}<span style="background-color: red">${t.substring(s,n)}</span>${t.substring(n)}`}},computed:{categorizedAnnotations(){const t={};return this.annotations.forEach((s=>{s[2].forEach((n=>{const e=this.labels[n].name,o=this.tokens.slice(s[0],s[1]+1).join(" "),a={index:[s[0],s[1]],word:o};t[e]?t[e].push(a):t[e]=[a]}))})),t},lLabels(){const t={};return Object.entries(this.labels).forEach((s=>{t[s[1].name]=s[1]})),t}}}),i=a,l=(n("8248"),n("2877")),c=n("9989"),r=n("ead5"),d=n("079e"),h=n("f09f"),u=n("0016"),m=n("9c40"),b=n("4983"),p=n("eebe"),f=n.n(p),g=Object(l["a"])(i,e,o,!1,null,null,null);s["default"]=g.exports;f()(g,"components",{QPage:c["a"],QBreadcrumbs:r["a"],QBreadcrumbsEl:d["a"],QCard:h["a"],QIcon:u["a"],QBtn:m["a"],QScrollArea:b["a"]})},8248:function(t,s,n){"use strict";n("82c1")},"82c1":function(t,s,n){}}]);